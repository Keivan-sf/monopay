---
sidebar_position: 5
title: "The Exclusive API"
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import CodeBlock from "@theme/CodeBlock";
import requestExclusiveTs from "!!raw-loader!../snippets/exclusive/request.ts";
import requestExclusiveJs from "!!raw-loader!../snippets/exclusive/request.js";
import verifyExclusiveTs from "!!raw-loader!../snippets/exclusive/verify.ts";
import verifyExclusiveJs from "!!raw-loader!../snippets/exclusive/verify.js";

This API is for when you _exclusively_ work with one payment driver.
for instance, here we're only using the Zarinpal driver.

:::info
If you're planning to use multiple services, check out the [Inclusive API](/docs/inclusive)
:::

## Request For Payment

Import the driver you want, and call the `request` function from it.
the argument"s fields might vary depending on the service you're using, the auto-completion will show you what fields are needed.

<Tabs>
  <TabItem value="typescript" label="TypeScript" default>
    <CodeBlock className="language-ts" title="index.ts">
      {requestExclusiveTs}
    </CodeBlock>
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
    <CodeBlock className="language-js" title="index.js">
      {requestExclusiveJs}
    </CodeBlock>
  </TabItem>
</Tabs>

:::note
the `request` function might throw `PaymentException`
:::

## Send User to Payment Page

The `paymentInfo` variable, will be somehting like this:

```json
{
  "method": "GET", // Could be POST, depends on the driver you're using
  "url": "https://payment.gateway/start-payment",
  "params": {
    "key": "value"
  }
}
```

When you have the payment info, create a form on the frontend, set its method to the method on `paymentInfo`, set its action to the `url` and add the `params` fields as inputs, then submit the form.

:::note
Most payment gateways don't require submiting a form on the client side, and are fine with simply redirecting the user from backend, but to support all the drivers with one interface, we're handling all of them on a form.
:::

:::tip
If you don't want to do this step manually, polypay exposes you a helper function, called `getScript` that you can use.

First generate the script:

```js
import { getScript } from "polypay.js";

const script = getScript(paymentInfo);
```

Then in your HTML, interpolate the script in a `script` tag.

```html
<h1>We're redirecting you to the payment gateway...</h1>
<script>
  {{ interpolate the `script` variable here }}
</script>
```

:::

If this step sounds confusing, check out our [examples](#example).

## Verify The Payment

Again, import the driver and then call `verify` from it.

This function accepts two objects:

1. an object, containing the `merchantId` and the `amount` of transaction
2. the express/fastify/koa/etc. Request object. (It must have a `query` field on it.)

<Tabs>
  <TabItem value="typescript" label="TypeScript" default>
    <CodeBlock className="language-ts" title="index.ts">
      {verifyExclusiveTs}
    </CodeBlock>
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
    <CodeBlock className="language-js" title="index.js">
      {verifyExclusiveJs}
    </CodeBlock>
  </TabItem>
</Tabs>

:::note
the `verify` function might throw `VerificationException`
:::

## Example

A example with exclusive API and express.js can be found here: [Exclusive API example](https://github.com/alitnk/polypay.js/blob/main/examples/exclusive-example/index.js)
